<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/public/assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    {% block stylesheets %}
    {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {% block javascripts %}
    {{ encore_entry_script_tags('app') }}
    {% endblock %}
</head>
{% block header %}

{{include("navbar.html.twig")}}


{% endblock %}

<body>
    {% block body %}

    {% endblock %}
    <p id="token"></p>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>
<script>
    var firebaseConfig = {
      apiKey: "AIzaSyCIMGV2_UKJL_FVMUXzBtZXslTTwpAOVEY",
      authDomain: "perfect-registration-cbfda.firebaseapp.com",
      projectId: "perfect-registration-cbfda",
      storageBucket: "perfect-registration-cbfda.appspot.com",
      messagingSenderId: "495348177232",
      appId: "1:495348177232:web:41faaf2ab28d13070ef455",
      measurementId: "G-HNEN5BHVCY"
    };
    firebase.initializeApp(firebaseConfig);
    const messaging=firebase.messaging();

    function IntitalizeFireBaseMessaging() {
        messaging
            .requestPermission()
            .then(function () {
                console.log("Notification Permission");
                return messaging.getToken();
            })
            .then(function (token) {
                console.log("Token : "+token);
                document.getElementById("token").innerHTML=token;
            })
            .catch(function (reason) {
                console.log(reason);
            });
    }

    messaging.onMessage(function (payload) {
        console.log(payload);
        const notificationOption={
            body:payload.notification.body,
            icon:payload.notification.icon
        };

        if(Notification.permission==="granted"){
            var notification=new Notification(payload.notification.title,notificationOption);

            notification.onclick=function (ev) {
                ev.preventDefault();
                window.open(payload.notification.click_action,'_blank');
                notification.close();
            }
        }

    });
    messaging.onTokenRefresh(function () {
        messaging.getToken()
            .then(function (newtoken) {
                console.log("New Token : "+ newtoken);
            })
            .catch(function (reason) {
                console.log(reason);
				//alert(reason);
            })
    })
    IntitalizeFireBaseMessaging();
</script>

    <div class="bg-white">
        <footer class="py-3 my-4">
            <ul class="nav justify-content-center border-bottom pb-3 mb-3">
                <li class="nav-item"><a href="{{path('app_home')}}" class="nav-link px-2 text-muted">Home</a></li>
                {% if app.user %}
                <li class="nav-item"><a href="{{path('app_users')}}" class="nav-link px-2 text-muted">{{ app.user.firstname }}</a></li>
                <li class="nav-item"><a href="{{path('app_logout')}}" class="nav-link px-2 text-muted">Deconnexion</a></li>
                {% else %}
                <li class="nav-item"><a href={{path("app_login")}} class="nav-link px-2 text-muted">Connection</a></li>

                <li class="nav-item"><a href={{path("app_register")}} class="nav-link px-2 text-muted">Inscription</a>
                </li>
                {% endif %}
            </ul>
            <p class="text-center text-muted">Â© 2022 Perfect Registration, Inc</p>
        </footer>
    </div>
</body>

</html>
